<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ $productData['short_description'] ?: $productData['name'] . ' - ููุชุฌ ุตุญู ุทุจูุนู ูู Bugsi' }}">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ $productData['name'] }} - Bugsi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ asset('assets/css/single-product.css') }}">
</head>
<body>
    @include('layouts.header')
    
    <!-- Product Section -->
    <section class="product-section">
        <div class="container">
            <!-- Product Container -->
            <div class="product-container">
                <!-- Product Gallery -->
                <div class="product-gallery">
                    <div class="main-image">
                        @if($productData['has_discount'])
                            <span class="product-badge sale">ุฎุตู {{ $productData['discount_percentage'] }}%</span>
                        @elseif($productData['is_new'])
                            <span class="product-badge new">ุฌุฏูุฏ</span>
                        @elseif($productData['is_featured'])
                            <span class="product-badge bestseller">ุงูุฃูุซุฑ ูุจูุนุงู</span>
                        @endif
                        <img src="{{ $productData['main_image_url'] ?: 'https://via.placeholder.com/600x600/0e9eff/ffffff?text=' . urlencode($productData['name']) }}" 
                             alt="{{ $productData['name'] }}" 
                             id="mainImage">
                    </div>
                    <div class="thumbnail-list">
                        <!-- Main image thumbnail -->
                        <div class="thumbnail active" data-image="{{ $productData['main_image_url'] ?: 'https://via.placeholder.com/600x600/0e9eff/ffffff?text=' . urlencode($productData['name']) }}">
                            <img src="{{ $productData['main_image_url'] ?: 'https://via.placeholder.com/150x150/0e9eff/ffffff?text=1' }}" alt="ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ">
                        </div>
                        
                        <!-- Gallery images -->
                        @if($productData['gallery_image_urls'] && count($productData['gallery_image_urls']) > 0)
                            @foreach($productData['gallery_image_urls'] as $index => $galleryImage)
                            <div class="thumbnail" data-image="{{ $galleryImage }}">
                                <img src="{{ $galleryImage }}" alt="ุตูุฑุฉ {{ $index + 2 }}">
                            </div>
                            @endforeach
                        @else
                            <!-- Placeholder thumbnails if no gallery images -->
                            <div class="thumbnail" data-image="https://via.placeholder.com/600x600/00d2d3/ffffff?text={{ urlencode($productData['name']) }}+2">
                                <img src="https://via.placeholder.com/150x150/00d2d3/ffffff?text=2" alt="ุตูุฑุฉ 2">
                            </div>
                            <div class="thumbnail" data-image="https://via.placeholder.com/600x600/0077cc/ffffff?text={{ urlencode($productData['name']) }}+3">
                                <img src="https://via.placeholder.com/150x150/0077cc/ffffff?text=3" alt="ุตูุฑุฉ 3">
                            </div>
                        @endif
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <div class="product-category">{{ $productData['category'] }}</div>
                    <h1 class="product-title">{{ $productData['name'] }}</h1>
                    
                    <div class="product-rating">
                        <span class="stars">โญโญโญโญโญ</span>
                        <span class="rating-text">{{ $productData['rating'] }} (<span class="rating-count">{{ $productData['reviews_count'] }} ุชูููู</span>)</span>
                    </div>

                    <div class="product-price">
                        <div class="price-wrapper">
                            @if($productData['has_discount'])
                                <span class="current-price">{{ $productData['sales_price'] }} MAD</span>
                                <span class="old-price">{{ $productData['price'] }} MAD</span>
                                <span class="discount-badge">ุฎุตู {{ $productData['discount_percentage'] }}%</span>
                            @else
                                <span class="current-price">{{ $productData['price'] }} MAD</span>
                            @endif
                        </div>
                        <span class="stock-status">
                            @if($productData['stock'] > 0)
                                โ ูุชููุฑ ูู ุงููุฎุฒูู ({{ $productData['stock'] }} ูุทุนุฉ)
                            @else
                                โ ููุฐ ูู ุงููุฎุฒูู
                            @endif
                        </span>
                    </div>

                    <p class="product-description">
                        {{ $productData['short_description'] ?: $productData['description'] ?: 'ููุชุฌ ุตุญู ุทุจูุนู ุนุงูู ุงูุฌูุฏุฉ ูุชููุฒ ุจุชุฑููุจุชู ุงููุฑูุฏุฉ ูุงูุขููุฉ ููุงุณุชุฎุฏุงู ุงููููู.' }}
                    </p>

                    @if($productData['tags'])
                    <div class="product-features">
                        <h3>ุงููุณูู</h3>
                        <div class="tags-list">
                            @foreach(explode(',', $productData['tags']) as $tag)
                                <span class="tag">{{ trim($tag) }}</span>
                            @endforeach
                        </div>
                    </div>
                    @endif

                    <div class="quantity-section">
                        <div class="quantity-label">ุงููููุฉ:</div>
                        <div class="quantity-selector">
                            <div class="quantity-controls">
                                <button class="quantity-btn" id="decreaseQty">-</button>
                                <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="{{ min($productData['stock'], 10) }}">
                                <button class="quantity-btn" id="increaseQty">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="product-actions">
                        <button class="btn btn-primary" id="addToCart" data-product-id="{{ $productData['id'] }}" {{ $productData['stock'] <= 0 ? 'disabled' : '' }}>
                            <span>๐</span>
                            @if($productData['stock'] > 0)
                                ุฃุถู ุฅูู ุงูุณูุฉ
                            @else
                                ููุฐ ูู ุงููุฎุฒูู
                            @endif
                        </button>
                        <button class="btn btn-secondary" id="buyNow" {{ $productData['stock'] <= 0 ? 'disabled' : '' }}>
                            ุงุดุชุฑ ุงูุขู
                        </button>
                    </div>

                    <div class="product-meta">
                        @if($productData['product_code'])
                        <div class="meta-item">
                            <span class="meta-label">ุฑูุฒ ุงูููุชุฌ:</span>
                            <span class="meta-value">{{ $productData['product_code'] }}</span>
                        </div>
                        @endif
                        <div class="meta-item">
                            <span class="meta-label">ุงููุฆุฉ:</span>
                            <span class="meta-value">{{ $productData['category'] }}</span>
                        </div>
                        @if($productData['tags'])
                        <div class="meta-item">
                            <span class="meta-label">ุงููุณูู:</span>
                            <span class="meta-value">{{ $productData['tags'] }}</span>
                        </div>
                        @endif
                    </div>
                </div>
            </div>

            <!-- Tabs Section -->
            <div class="tabs-section">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="description">ุงููุตู</button>
                    <button class="tab-btn" data-tab="info">ูุนูููุงุช ุฅุถุงููุฉ</button>
                    <button class="tab-btn" data-tab="reviews">ุงูุชููููุงุช ({{ $productData['reviews_count'] }})</button>
                </div>

                <div class="tab-content active" id="description">
                    <h3>ูุตู ุงูููุชุฌ</h3>
                    @if($productData['description'])
                        {!! nl2br(e($productData['description'])) !!}
                    @else
                        <p>{{ $productData['name'] }} ูู ููุชุฌ ุตุญู ุทุจูุนู ูุฑูุฏ ูู ููุนูุ ูุชููุฒ ุจุฌูุฏุชู ุงูุนุงููุฉ ููุนุงููุชู ุงูููุชุงุฒุฉ.</p>
                        <p>ูุณุชุฎุฏู ูุฐุง ุงูููุชุฌ ุนูู ูุทุงู ูุงุณุน ูุฏุนู ุงูุตุญุฉ ุงูุนุงูุฉ ูุชุนุฒูุฒ ูุธุงุฆู ุงูุฌุณู ุงูุทุจูุนูุฉ.</p>
                        <p>ูุญู ูู Bugsi ูุถูู ูู ุงูุญุตูู ุนูู ููุชุฌ ุฃุตูู ููุนุชูุฏุ ูุน ุงูุชุฒุงููุง ุงููุงูู ุจุชูููุฑ ุฃุนูู ูุนุงููุฑ ุงูุฌูุฏุฉ ูุงูุฎุฏูุฉ.</p>
                    @endif
                </div>

                <div class="tab-content" id="info">
                    <h3>ูุนูููุงุช ุฅุถุงููุฉ</h3>
                    @if($productData['additional_info'] && count($productData['additional_info']) > 0)
                        <table style="width: 100%; border-collapse: collapse;">
                            @if(isset($productData['additional_info']['size']) && $productData['additional_info']['size'])
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ุงูุญุฌู:</td>
                                <td style="padding: 15px 0;">{{ $productData['additional_info']['size'] }}</td>
                            </tr>
                            @endif
                            @if(isset($productData['additional_info']['ingredients']) && $productData['additional_info']['ingredients'])
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ุงูููููุงุช:</td>
                                <td style="padding: 15px 0;">{{ $productData['additional_info']['ingredients'] }}</td>
                            </tr>
                            @endif
                            @if(isset($productData['additional_info']['usage']) && $productData['additional_info']['usage'])
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ุงูุงุณุชุฎุฏุงู:</td>
                                <td style="padding: 15px 0;">{{ $productData['additional_info']['usage'] }}</td>
                            </tr>
                            @endif
                            @if(isset($productData['additional_info']['expiry']) && $productData['additional_info']['expiry'])
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ูุฏุฉ ุงูุตูุงุญูุฉ:</td>
                                <td style="padding: 15px 0;">{{ $productData['additional_info']['expiry'] }}</td>
                            </tr>
                            @endif
                            @if(isset($productData['additional_info']['storage']) && $productData['additional_info']['storage'])
                            <tr>
                                <td style="padding: 15px 0; font-weight: 700;">ุงูุชุฎุฒูู:</td>
                                <td style="padding: 15px 0;">{{ $productData['additional_info']['storage'] }}</td>
                            </tr>
                            @endif
                        </table>
                    @else
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ุงูููุชุฌ:</td>
                                <td style="padding: 15px 0;">{{ $productData['name'] }}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px 0; font-weight: 700;">ุงููุฆุฉ:</td>
                                <td style="padding: 15px 0;">{{ $productData['category'] }}</td>
                            </tr>
                            <tr>
                                <td style="padding: 15px 0; font-weight: 700;">ุงูุญุงูุฉ:</td>
                                <td style="padding: 15px 0;">ููุชุฌ ุทุจูุนู ุนุงูู ุงูุฌูุฏุฉ</td>
                            </tr>
                        </table>
                    @endif
                </div>

                <div class="tab-content" id="reviews">
                    <h3>ุชููููุงุช ุงูุนููุงุก</h3>
                    
                    <div class="reviews-summary">
                        <div class="overall-rating">
                            <div class="rating-number">{{ $productData['rating'] }}</div>
                            <div class="stars" style="font-size: 24px; margin-bottom: 10px;">โญโญโญโญโญ</div>
                            <div style="color: var(--text-gray); font-size: 14px;">{{ $productData['reviews_count'] }} ุชูููู</div>
                        </div>

                        <div class="rating-bars">
                            <div class="rating-bar-item">
                                <span class="bar-label">5 ูุฌูู</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 85%"></div>
                                </div>
                                <span class="bar-count">{{ intval($productData['reviews_count'] * 0.85) }}</span>
                            </div>
                            <div class="rating-bar-item">
                                <span class="bar-label">4 ูุฌูู</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 10%"></div>
                                </div>
                                <span class="bar-count">{{ intval($productData['reviews_count'] * 0.10) }}</span>
                            </div>
                            <div class="rating-bar-item">
                                <span class="bar-label">3 ูุฌูู</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 3%"></div>
                                </div>
                                <span class="bar-count">{{ intval($productData['reviews_count'] * 0.03) }}</span>
                            </div>
                            <div class="rating-bar-item">
                                <span class="bar-label">2 ูุฌูู</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 1%"></div>
                                </div>
                                <span class="bar-count">{{ intval($productData['reviews_count'] * 0.01) }}</span>
                            </div>
                            <div class="rating-bar-item">
                                <span class="bar-label">1 ูุฌูุฉ</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 1%"></div>
                                </div>
                                <span class="bar-count">{{ intval($productData['reviews_count'] * 0.01) }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sample reviews -->
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">ุฃ</div>
                                <div>
                                    <div class="reviewer-name">ุฃุญูุฏ ุงูููุตูุฑู</div>
                                    <div class="stars" style="font-size: 16px;">โญโญโญโญโญ</div>
                                </div>
                            </div>
                            <div class="review-date">ููุฐ ุฃุณุจูุน</div>
                        </div>
                        <p class="review-text">ููุชุฌ ููุชุงุฒ ููุนุงู ุฌุฏุงู! ูุงุญุธุช ุชุญุณูุงู ูุจูุฑุงู ูู ุตุญุชู ุงูุนุงูุฉ ุจุนุฏ ุงุณุชุฎุฏุงูู. ุงูุฌูุฏุฉ ุนุงููุฉ ูุงูุฎุฏูุฉ ููุชุงุฒุฉ. ุฃูุตุญ ุจู ุจุดุฏุฉ!</p>
                    </div>

                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">ู</div>
                                <div>
                                    <div class="reviewer-name">ูุงุทูุฉ ุงูุฒูุฑุงุก</div>
                                    <div class="stars" style="font-size: 16px;">โญโญโญโญโญ</div>
                                </div>
                            </div>
                            <div class="review-date">ููุฐ ุฃุณุจูุนูู</div>
                        </div>
                        <p class="review-text">ุฑุงุถูุฉ ุฌุฏุงู ุนู ุงูููุชุฌ! ุงูุดุญู ูุงู ุณุฑูุน ูุงูููุชุฌ ุฃุตูู 100%. ุณุฃุทูุจู ูุฑุฉ ุฃุฎุฑู ุจุงูุชุฃููุฏ.</p>
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            @if($relatedProducts && count($relatedProducts) > 0)
            <div class="related-section">
                <div class="section-header">
                    <h2>ููุชุฌุงุช ุฐุงุช ุตูุฉ</h2>
                    <p>ูุฏ ุชุนุฌุจู ุฃูุถุงู</p>
                </div>

                <div class="products-grid">
                    @foreach($relatedProducts as $relatedProduct)
                    <div class="product-card" onclick="window.location.href='/product/{{ $relatedProduct['slug'] }}'">
                        <div class="product-image">
                            <img src="{{ $relatedProduct['main_image_url'] ?: 'https://via.placeholder.com/300x200/0e9eff/ffffff?text=' . urlencode($relatedProduct['name']) }}" 
                                 alt="{{ $relatedProduct['name'] }}">
                        </div>
                        <div class="product-card-info">
                            <h3>{{ $relatedProduct['name'] }}</h3>
                            <div class="product-card-price">
                                @if($relatedProduct['has_discount'])
                                    <span class="old-price-small">{{ $relatedProduct['price'] }} MAD</span>
                                    <span class="current-price-small">{{ $relatedProduct['sales_price'] }} MAD</span>
                                @else
                                    {{ $relatedProduct['price'] }} MAD
                                @endif
                            </div>
                        </div>
                    </div>
                    @endforeach
                </div>
            </div>
            @endif
        </div>
    </section>

    <script>
        // Pass product data to JavaScript
        window.productData = @json($productData);
    </script>
    <!-- Load cart manager first, then single product script -->
    <script src="{{ asset('assets/js/cart-manager.js') }}"></script>
    <script src="{{ asset('assets/js/single-product.js') }}"></script>
</body>
</html>